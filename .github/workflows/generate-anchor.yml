name: Generate Anchor Image

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install google-genai pillow
      
      - name: Generate and save anchor
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          python - <<EOF
          from google import genai
          from google.genai import types
          import os
          import pickle
          
          client = genai.Client(api_key=os.getenv("GEMINI_API_KEY"))
          
          anchor_prompt = """A professional blonde female news anchor at a broadcast desk. Medium close-up shot with anchor positioned on left third of frame, leaving empty space over right shoulder for graphics. Direct eye contact with camera, serious authoritative expression. Business professional attire. Modern news studio with soft lighting, blue and neutral tones in background. Static composition, no camera movement. No text overlays, no chyrons, no graphics, clean frame. High quality broadcast photography, photorealistic."""
          
          image_response = client.models.generate_content(
              model="gemini-2.5-flash-image",
              contents=anchor_prompt,
              config=types.GenerateContentConfig(
                  response_modalities=['IMAGE'],
                  image_config=types.ImageConfig(
                      aspect_ratio="16:9"
                  )
              )
          )
          
          # Save the entire Part object with pickle
          with open("anchor_part.pkl", "wb") as f:
              pickle.dump(image_response.parts[0], f)
          
          # Also save as PNG for reference
          anchor_image = image_response.parts[0].as_image()
          anchor_image.save("Diane-Nano.png")
          
          print("âœ… Saved 16:9 anchor Part object and PNG")
          EOF
      
      - name: Upload anchor files
        uses: actions/upload-artifact@v4
        with:
          name: anchor-files
          path: |
            anchor_part.pkl
            Diane-Nano.png
          if-no-files-found: error
